<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>PAS SI VITE, CHAROGNE</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<style>
		* {
			font-family: Verdana, Geneva, Tahoma, sans-serif;
			background-color: black;
			color: white;
		}

		img {
			width: 50vw;
			margin-left: 25vw;
		}
	</style>
</head>

<body>
	<h1 class="center-align">Tu dois attendre avant de retenter ta chance ðŸ¤·</h1>
	<img src="https://media.giphy.com/media/cjhBClBwZAHs3TEzDH/giphy.gif" alt="wait">

	<h1 id="timer" class="center-align"></h1>

	<p id="gage" class="center-align"></p>

	<div class="container">
		<h1 class="center-align">Leaderboard</h1>

		<table class="centered">
			<thead>
				<th>Login</th>
				<th>Parties</th>
				<th>TIG</th>
				<th>Gages</th>
				<th>Total de points</th>
			</thead>
			<tbody id="infos">

			</tbody>
		</table>
	</div>

	<script>
		var countDownDate = Math.floor( <%= countDownDate %> ) + (3600000 * 2);

		var x = setInterval(function () {

				var now = Date.now();
				var distance = countDownDate - now;


				var hours = Math.floor(distance / (1000 * 60 * 60));
				var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				var seconds = Math.floor((distance % (1000 * 60)) / 1000);

				if (hours < 10)
					hours = '0' + hours;
				if (minutes < 10)
					minutes = '0' + minutes;
				if (seconds < 10)
					seconds = '0' + seconds;

				document.getElementById("timer").innerHTML = hours + " : " + minutes + " : " + seconds + "";

				if (distance < 0) {
					clearInterval(x);
					document.getElementById("timer").innerHTML = "EXPIRED";
				}
			},
			1000);
	</script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		var infos = document.getElementById("infos")
		axios.get('/api')
			.then(response => {
				var users = response.data;
				for (i in users) {
					infos.innerHTML +=
						"<tr>\
                        <td><a target='_blank' href='https://profile.intra.42.fr/users/" + users[i].login + "'>" +
						users[i].login + "</a></td>\
                        <td>" + users[i].activity.length + " parties</td>\
						<td>" + users[i].total_hours + "h</td>\
						<td>" + users[i].total_gages + "</td>\
                        <td>" + users[i].total_points + " pts</td>\
                    </tr>"
				}
			})
			.catch(error => {
				console.log(error);
			})
</script>
<script>
		axios.get('/api/me')
		.then(response => {
			console.log(response);
			last_entry = response.data.activity[response.data.activity.length - 1];
			console.log(last_entry);
			if (last_entry.kind == "Gage") {
				document.getElementById('gage').innerText = 'Tu as actuellement un gage Ã  effectuer : ' + last_entry.mission;
			}
		})
		.catch(error => {
			console.log(error);
		})
	</script>

</body>

</html>